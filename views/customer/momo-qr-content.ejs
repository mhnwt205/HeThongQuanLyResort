<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white text-center py-4">
                    <h3 class="mb-0">
                        <i class="fas fa-qrcode me-2"></i>
                        Thanh toán MoMo
                    </h3>
                </div>
                
                <div class="card-body p-5">
                    <!-- QR Code -->
                    <div class="text-center mb-4">
                        <div class="qr-container p-4 bg-light rounded">
                            <img src="<%= qrCode %>" alt="QR Code MoMo" class="img-fluid" style="max-width: 300px;">
                        </div>
                        <p class="text-muted mt-3">
                            <i class="fas fa-mobile-alt me-2"></i>
                            Quét mã QR để xem thông tin chuyển khoản
                        </p>
                    </div>

                    <!-- Thông tin thanh toán -->
                    <div class="payment-info">
                        <h5 class="text-center mb-4">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            Thông tin thanh toán
                        </h5>
                        
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="info-item">
                                    <label class="form-label text-muted">Mã đặt phòng:</label>
                                    <div class="fw-bold text-primary"><%= bookingCode %></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <label class="form-label text-muted">Số tiền:</label>
                                    <div class="fw-bold text-success fs-5"><%= amount %></div>
                                </div>
                            </div>
                            <% if (roomNumber) { %>
                            <div class="col-6">
                                <div class="info-item">
                                    <label class="form-label text-muted">Phòng:</label>
                                    <div class="fw-bold">Phòng <%= roomNumber %></div>
                                </div>
                            </div>
                            <% } %>
                            <% if (customerName) { %>
                            <div class="col-6">
                                <div class="info-item">
                                    <label class="form-label text-muted">Khách hàng:</label>
                                    <div class="fw-bold"><%= customerName %></div>
                                </div>
                            </div>
                            <% } %>
                        </div>
                    </div>

                    <!-- Thông tin chuyển khoản -->
                    <% if (typeof isTransferQR !== 'undefined' && isTransferQR) { %>
                    <div class="transfer-info mt-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-info-circle me-2"></i>
                            Thông tin chuyển khoản:
                        </h6>
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="info-item">
                                    <label class="form-label text-muted">Người nhận:</label>
                                    <div class="fw-bold text-success"><%= adminMoMoInfo.name %></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <label class="form-label text-muted">Số điện thoại:</label>
                                    <div class="fw-bold"><%= adminMoMoInfo.phone %></div>
                                    <small class="text-muted">VietQR: 970422</small>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="info-item">
                                    <label class="form-label text-muted">Nội dung chuyển khoản:</label>
                                    <div class="fw-bold text-primary d-flex align-items-center">
                                        <span id="transferContent" class="me-2"><%= transferContent %></span>
                                        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('transferContent')" title="Copy">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% } %>

                    <!-- Hướng dẫn -->
                    <div class="instructions mt-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-list-ol me-2"></i>
                            Hướng dẫn thanh toán:
                        </h6>
                        <ol class="list-group list-group-numbered">
                            <li class="list-group-item border-0 px-0">
                                Mở ứng dụng MoMo trên điện thoại
                            </li>
                            <li class="list-group-item border-0 px-0">
                                Chọn "Chuyển tiền" hoặc "Transfer"
                            </li>
                            <li class="list-group-item border-0 px-0">
                                Nhập số điện thoại: <strong><%= adminMoMoInfo.phone %></strong>
                            </li>
                            <li class="list-group-item border-0 px-0">
                                Nhập số tiền: <strong><%= amount %></strong>
                            </li>
                            <li class="list-group-item border-0 px-0">
                                Nhập nội dung: <strong><%= transferContent %></strong>
                            </li>
                            <li class="list-group-item border-0 px-0">
                                Nhập mật khẩu và xác nhận chuyển khoản
                            </li>
                        </ol>
                    </div>

                    <!-- Nút hành động -->
                    <div class="text-center mt-4">
                        <% if (typeof isTransferQR !== 'undefined' && isTransferQR) { %>
                        <a href="<%= `https://momo.vn/transfer?phone=${adminMoMoInfo.phone}&amount=${amount.replace(/[^\d]/g, '')}&note=${encodeURIComponent(transferContent)}` %>" class="btn btn-success btn-lg me-3" target="_blank">
                            <i class="fas fa-mobile-alt me-2"></i>
                            Mở MoMo Web
                        </a>
                        <% } else { %>
                        <a href="<%= momoUrl %>" class="btn btn-success btn-lg me-3" target="_blank">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Mở MoMo Web
                        </a>
                        <% } %>
                        <button onclick="window.history.back()" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-arrow-left me-2"></i>
                            Quay lại
                        </button>
                    </div>

                    <!-- Lưu ý -->
                    <div class="alert alert-warning mt-4">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Lưu ý:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Vui lòng chuyển khoản trong vòng 15 phút</li>
                            <li>Kiểm tra kỹ số tiền và nội dung chuyển khoản</li>
                            <li>Đảm bảo số điện thoại người nhận chính xác</li>
                            <li>Sau khi chuyển khoản thành công, bạn sẽ nhận được email xác nhận</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.qr-container {
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.info-item {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

.instructions ol {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #28a745;
}

.card {
    border-radius: 15px;
}

.card-header {
    border-radius: 15px 15px 0 0 !important;
}

.btn {
    border-radius: 25px;
    padding: 12px 30px;
}

.alert {
    border-radius: 10px;
    border: none;
}
</style>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        // Hiển thị thông báo thành công
        const button = element.nextElementSibling;
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.remove('btn-outline-primary');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-primary');
        }, 2000);
    }).catch(function(err) {
        console.error('Lỗi copy: ', err);
        alert('Không thể copy. Vui lòng copy thủ công: ' + text);
    });
}
</script>
